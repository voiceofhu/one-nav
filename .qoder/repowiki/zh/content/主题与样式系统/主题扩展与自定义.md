# ä¸»é¢˜æ‰©å±•ä¸è‡ªå®šä¹‰

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [theme.tsx](file://src/components/providers/theme.tsx)
- [globals.css](file://src/app/globals.css)
- [postcss.config.mjs](file://postcss.config.mjs)
</cite>

## ç›®å½•

1. [é¡¹ç›®ç»“æ„åˆ†æ](#é¡¹ç›®ç»“æ„åˆ†æ)
2. [æ ¸å¿ƒä¸»é¢˜ç³»ç»Ÿç»„ä»¶](#æ ¸å¿ƒä¸»é¢˜ç³»ç»Ÿç»„ä»¶)
3. [ä¸»é¢˜å˜é‡å®šä¹‰ä¸CSSä½œç”¨åŸŸ](#ä¸»é¢˜å˜é‡å®šä¹‰ä¸cssä½œç”¨åŸŸ)
4. [ä¸»é¢˜åˆ‡æ¢æœºåˆ¶å®ç°](#ä¸»é¢˜åˆ‡æ¢æœºåˆ¶å®ç°)
5. [æ·»åŠ æ–°ä¸»é¢˜å˜ä½“](#æ·»åŠ æ–°ä¸»é¢˜å˜ä½“)
6. [UIåˆ‡æ¢æ§ä»¶å®ç°](#uiåˆ‡æ¢æ§ä»¶å®ç°)
7. [ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»å¤„ç†](#ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»å¤„ç†)
8. [åŠ¨æ€ä¸»é¢˜åŠ è½½é«˜çº§ç”¨ä¾‹](#åŠ¨æ€ä¸»é¢˜åŠ è½½é«˜çº§ç”¨ä¾‹)
9. [å¸¸è§é—®é¢˜ä¸è°ƒè¯•](#å¸¸è§é—®é¢˜ä¸è°ƒè¯•)

## é¡¹ç›®ç»“æ„åˆ†æ

æœ¬é¡¹ç›®é‡‡ç”¨Next.jsæ¶æ„ï¼Œä¸»é¢˜ç³»ç»Ÿä¸»è¦ç”±`next-themes`åº“é©±åŠ¨ï¼Œç»“åˆTailwind CSSå’Œè‡ªå®šä¹‰CSSå˜é‡å®ç°ã€‚æ ¸å¿ƒä¸»é¢˜ç›¸å…³æ–‡ä»¶ä½äºï¼š

- `src/components/providers/theme.tsx`ï¼šä¸»é¢˜æä¾›è€…ç»„ä»¶
- `src/app/globals.css`ï¼šå…¨å±€CSSå˜é‡å®šä¹‰
- `postcss.config.mjs`ï¼šPostCSSé…ç½®ï¼Œé›†æˆTailwind

ä¸»é¢˜ç³»ç»Ÿé€šè¿‡`data-theme`å±æ€§æˆ–CSSç±»æ¥æ§åˆ¶æ ·å¼ä½œç”¨åŸŸï¼Œé¿å…å…¨å±€æ ·å¼æ±¡æŸ“ã€‚

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L1-L16)
- [globals.css](file://src/app/globals.css#L1-L122)

## æ ¸å¿ƒä¸»é¢˜ç³»ç»Ÿç»„ä»¶

`ThemeProvider`ç»„ä»¶å°è£…äº†`next-themes`çš„`ThemeProvider`ï¼Œæ˜¯æ•´ä¸ªåº”ç”¨ä¸»é¢˜æ§åˆ¶çš„æ ¸å¿ƒã€‚å®ƒé€šè¿‡React Contextå‘ä¸‹ä¼ é€’ä¸»é¢˜çŠ¶æ€ã€‚

```tsx
'use client';

import { ThemeProvider as NextThemesProvider } from 'next-themes';
import * as React from 'react';

export function ThemeProvider({ children }: React.PropsWithChildren) {
  return (
    <NextThemesProvider
      attribute="class"
      defaultTheme="system"
      enableSystem
      disableTransitionOnChange
    >
      {children}
    </NextThemesProvider>
  );
}
```

å…³é”®é…ç½®è¯´æ˜ï¼š

- **attribute**: `"class"` è¡¨ç¤ºä½¿ç”¨CSSç±»è€Œé`data-theme`å±æ€§æ§åˆ¶ä¸»é¢˜
- **defaultTheme**: `"system"` é»˜è®¤è·Ÿéšç³»ç»Ÿä¸»é¢˜
- **enableSystem**: å¯ç”¨ç³»ç»Ÿä¸»é¢˜æ£€æµ‹
- **disableTransitionOnChange**: åˆ‡æ¢ä¸»é¢˜æ—¶ç¦ç”¨CSSè¿‡æ¸¡åŠ¨ç”»

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L1-L16)

## ä¸»é¢˜å˜é‡å®šä¹‰ä¸CSSä½œç”¨åŸŸ

å…¨å±€ä¸»é¢˜å˜é‡åœ¨`globals.css`ä¸­å®šä¹‰ï¼Œä½¿ç”¨CSSè‡ªå®šä¹‰å±æ€§ï¼ˆCSS Variablesï¼‰å®ç°ä¸»é¢˜åŒ–ã€‚

```css
:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  /* å…¶ä»–å˜é‡... */
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  /* å…¶ä»–å˜é‡... */
}
```

### ä¸»é¢˜å˜é‡æ˜ å°„

```css
@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  /* ... */
}
```

æ­¤æ˜ å°„å…è®¸ç»„ä»¶é€šè¿‡ç»Ÿä¸€çš„å˜é‡åè®¿é—®ä¸»é¢˜é¢œè‰²ï¼Œè€Œå®é™…å€¼ç”±`:root`æˆ–`.dark`ç±»å†³å®šã€‚

**Section sources**

- [globals.css](file://src/app/globals.css#L45-L122)

## ä¸»é¢˜åˆ‡æ¢æœºåˆ¶å®ç°

å½“å‰ç³»ç»Ÿä½¿ç”¨`class`å±æ€§ä½œä¸ºä¸»é¢˜åˆ‡æ¢çš„è§¦å‘å™¨ï¼Œè€Œé`data-theme`ã€‚è¿™æ˜¯é€šè¿‡`ThemeProvider`ä¸­çš„`attribute="class"`é…ç½®å®ç°çš„ã€‚

### åˆ‡æ¢åŸç†

å½“ç”¨æˆ·åˆ‡æ¢ä¸»é¢˜æ—¶ï¼š

1. `next-themes`ä¼šåœ¨`<html>`å…ƒç´ ä¸Šæ·»åŠ ç›¸åº”çš„CSSç±»ï¼ˆå¦‚`dark`ï¼‰
2. CSSå¼•æ“æ ¹æ®ç±»ååº”ç”¨å¯¹åº”çš„å˜é‡å€¼
3. æ‰€æœ‰ä½¿ç”¨è¿™äº›å˜é‡çš„ç»„ä»¶è‡ªåŠ¨æ›´æ–°æ ·å¼

### ä½œç”¨åŸŸæ§åˆ¶

é€šè¿‡`:root`å’Œ`.dark`é€‰æ‹©å™¨çš„ä½œç”¨åŸŸåˆ†ç¦»ï¼Œç¡®ä¿ä¸»é¢˜å˜é‡ä¸ä¼šç›¸äº’æ±¡æŸ“ã€‚æ‰€æœ‰ç»„ä»¶é€šè¿‡`var(--color-primary)`ç­‰æ–¹å¼å¼•ç”¨å˜é‡ï¼Œå®ç°æ ·å¼è§£è€¦ã€‚

```css
@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

Tailwindçš„`@apply`æŒ‡ä»¤å¼•ç”¨ä¸»é¢˜å˜é‡ï¼Œå®ç°å“åº”å¼æ ·å¼ã€‚

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L8-L14)
- [globals.css](file://src/app/globals.css#L45-L122)

## æ·»åŠ æ–°ä¸»é¢˜å˜ä½“

è¦æ·»åŠ æ–°çš„ä¸»é¢˜å˜ä½“ï¼ˆå¦‚"æ·±è“"ã€"æŠ¤çœ¼ç»¿"ï¼‰ï¼Œéœ€æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

### 1. åœ¨`globals.css`ä¸­å®šä¹‰æ–°ä¸»é¢˜

```css
/* æ·±è“ä¸»é¢˜ */
.theme-deep-blue {
  --background: #0a192f;
  --foreground: #e6f1ff;
  --primary: #007acc;
  --primary-foreground: white;
  /* å®šä¹‰å…¶ä»–å˜é‡... */
}

/* æŠ¤çœ¼ç»¿ä¸»é¢˜ */
.theme-eye-care {
  --background: #f5f7e9;
  --foreground: #3e4a3d;
  --primary: #4a7c59;
  --primary-foreground: white;
  /* å®šä¹‰å…¶ä»–å˜é‡... */
}
```

### 2. é…ç½®`next-themes`æ”¯æŒæ–°ä¸»é¢˜

ä¿®æ”¹`theme.tsx`ï¼Œæ·»åŠ `themes`å±æ€§ï¼š

```tsx
export function ThemeProvider({ children }: React.PropsWithChildren) {
  return (
    <NextThemesProvider
      attribute="class"
      defaultTheme="system"
      enableSystem
      disableTransitionOnChange
      themes={['light', 'dark', 'deep-blue', 'eye-care']}
    >
      {children}
    </NextThemesProvider>
  );
}
```

### 3. ä½¿ç”¨ä¸»é¢˜åˆ‡æ¢API

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨`useTheme`é’©å­åˆ‡æ¢ä¸»é¢˜ï¼š

```tsx
import { useTheme } from 'next-themes';

function ThemeSwitcher() {
  const { setTheme } = useTheme();

  return (
    <div>
      <button onClick={() => setTheme('light')}>æµ…è‰²</button>
      <button onClick={() => setTheme('dark')}>æ·±è‰²</button>
      <button onClick={() => setTheme('deep-blue')}>æ·±è“</button>
      <button onClick={() => setTheme('eye-care')}>æŠ¤çœ¼ç»¿</button>
    </div>
  );
}
```

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L8-L16)
- [globals.css](file://src/app/globals.css#L45-L122)

## UIåˆ‡æ¢æ§ä»¶å®ç°

### ä¸‹æ‹‰èœå•å®ç°

```tsx
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { useTheme } from 'next-themes';

function ThemeSelector() {
  const { theme, setTheme } = useTheme();

  return (
    <Select value={theme} onValueChange={setTheme}>
      <SelectTrigger className="w-[180px]">
        <SelectValue placeholder="é€‰æ‹©ä¸»é¢˜" />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="light">æµ…è‰²</SelectItem>
        <SelectItem value="dark">æ·±è‰²</SelectItem>
        <SelectItem value="deep-blue">æ·±è“</SelectItem>
        <SelectItem value="eye-care">æŠ¤çœ¼ç»¿</SelectItem>
      </SelectContent>
    </Select>
  );
}
```

### æŒ‰é’®ç»„å®ç°

```tsx
import { Button } from '@/components/ui/button';
import { useTheme } from 'next-themes';

function ThemeToggle() {
  const { theme, setTheme } = useTheme();

  const themes = [
    { value: 'light', label: 'â˜€ï¸' },
    { value: 'dark', label: 'ğŸŒ™' },
    { value: 'deep-blue', label: 'ğŸ”µ' },
    { value: 'eye-care', label: 'ğŸŸ¢' },
  ] as const;

  return (
    <div className="flex gap-2">
      {themes.map(({ value, label }) => (
        <Button
          key={value}
          variant={theme === value ? 'default' : 'outline'}
          size="icon"
          onClick={() => setTheme(value)}
        >
          {label}
        </Button>
      ))}
    </div>
  );
}
```

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L8-L16)

## ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»å¤„ç†

å½“å‰é…ç½®`disableTransitionOnChange`ç¦ç”¨äº†ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»ã€‚è¦å®ç°å¹³æ»‘è¿‡æ¸¡ï¼Œéœ€è¿›è¡Œä»¥ä¸‹ä¿®æ”¹ï¼š

### 1. å¯ç”¨è¿‡æ¸¡åŠ¨ç”»

```tsx
// theme.tsx
<NextThemesProvider
  attribute="class"
  defaultTheme="system"
  enableSystem
  // ç§»é™¤ disableTransitionOnChange
>
  {children}
</NextThemesProvider>
```

### 2. æ·»åŠ CSSè¿‡æ¸¡

```css
/* globals.css */
* {
  transition:
    background-color 0.3s ease,
    color 0.3s ease,
    border-color 0.3s ease;
}
```

### 3. é’ˆå¯¹ç‰¹å®šå…ƒç´ ä¼˜åŒ–

```css
/* ä¸ºç‰¹å®šç»„ä»¶æ·»åŠ æ›´ç²¾ç»†çš„è¿‡æ¸¡ */
.bg-background {
  transition: background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.text-foreground {
  transition: color 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
```

### 4. ä½¿ç”¨CSSè‡ªå®šä¹‰å±æ€§è¿‡æ¸¡

```css
:root {
  --transition-duration: 0.3s;
  --transition-easing: ease;
}

* {
  transition:
    background-color var(--transition-duration) var(--transition-easing),
    color var(--transition-duration) var(--transition-easing),
    border-color var(--transition-duration) var(--transition-easing);
}
```

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L8-L14)
- [globals.css](file://src/app/globals.css#L100-L122)

## åŠ¨æ€ä¸»é¢˜åŠ è½½é«˜çº§ç”¨ä¾‹

### è¿œç¨‹ä¸»é¢˜åŒ…åŠ è½½

```tsx
import { useTheme } from 'next-themes';

async function loadRemoteTheme(themeName: string) {
  try {
    const response = await fetch(`/api/themes/${themeName}`);
    const themeData = await response.json();

    // åŠ¨æ€åˆ›å»ºæ ·å¼æ ‡ç­¾
    const style = document.createElement('style');
    style.id = `theme-${themeName}`;
    style.textContent = `
      .theme-${themeName} {
        ${Object.entries(themeData.variables)
          .map(([key, value]) => `--${key}: ${value};`)
          .join('\n')}
      }
    `;

    document.head.appendChild(style);

    // æ›´æ–°ä¸»é¢˜
    const { setTheme } = useTheme();
    setTheme(themeName);

    // æ›´æ–°å¯ç”¨ä¸»é¢˜åˆ—è¡¨
    updateAvailableThemes((prev) => [...prev, themeName]);
  } catch (error) {
    console.error('åŠ è½½è¿œç¨‹ä¸»é¢˜å¤±è´¥:', error);
  }
}
```

### æŒ‰éœ€åŠ è½½ä¸»é¢˜èµ„æº

```tsx
// ä¸»é¢˜æ³¨å†Œè¡¨
const themeRegistry = {
  'deep-blue': () => import('@/themes/deep-blue.css'),
  'eye-care': () => import('@/themes/eye-care.css'),
};

async function ensureThemeLoaded(themeName: string) {
  if (!document.getElementById(`theme-${themeName}`)) {
    const cssModule = await themeRegistry[themeName]?.();
    const style = document.createElement('style');
    style.id = `theme-${themeName}`;
    style.textContent = cssModule?.default || '';
    document.head.appendChild(style);
  }
}
```

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L1-L16)

## å¸¸è§é—®é¢˜ä¸è°ƒè¯•

### å¸¸è§é”™è¯¯

#### 1. å˜é‡æœªå®šä¹‰

**ç°è±¡**ï¼šä¸»é¢˜é¢œè‰²æœªç”Ÿæ•ˆï¼Œæ˜¾ç¤ºé»˜è®¤é¢œè‰²
**åŸå› **ï¼šCSSå˜é‡åæ‹¼å†™é”™è¯¯æˆ–æœªåœ¨å¯¹åº”ä¸»é¢˜å—ä¸­å®šä¹‰
**è§£å†³æ–¹æ¡ˆ**ï¼š

- æ£€æŸ¥å˜é‡åæ˜¯å¦ä¸€è‡´
- ç¡®ä¿æ‰€æœ‰ä¸»é¢˜éƒ½å®šä¹‰äº†å¿…è¦çš„å˜é‡
- ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥è®¡ç®—æ ·å¼

#### 2. ä¸»é¢˜ä¸ç”Ÿæ•ˆ

**ç°è±¡**ï¼šåˆ‡æ¢ä¸»é¢˜åæ ·å¼æ— å˜åŒ–
**åŸå› **ï¼š

- `attribute`é…ç½®ä¸CSSé€‰æ‹©å™¨ä¸åŒ¹é…
- ç¼ºå°‘å¿…è¦çš„CSSç±»
- å˜é‡ç»§æ‰¿é—®é¢˜

**è°ƒè¯•æ­¥éª¤**ï¼š

1. æ£€æŸ¥`<html>`å…ƒç´ æ˜¯å¦æ·»åŠ äº†æ­£ç¡®çš„ç±»
2. ç¡®è®¤`globals.css`ä¸­å®šä¹‰äº†å¯¹åº”çš„ä¸»é¢˜ç±»
3. éªŒè¯CSSå˜é‡æ˜¯å¦æ­£ç¡®ç»§æ‰¿

```bash
# è°ƒè¯•å‘½ä»¤
# æ£€æŸ¥ä¸»é¢˜æä¾›è€…é…ç½®
grep -n "ThemeProvider" src/components/providers/theme.tsx

# æ£€æŸ¥CSSå˜é‡å®šä¹‰
grep -n "var(--" src/app/globals.css
```

### è°ƒè¯•å·¥å…·

```tsx
// å¼€å‘ç¯å¢ƒä¸»é¢˜è°ƒè¯•ç»„ä»¶
function ThemeDebugger() {
  const { theme, setTheme, resolvedTheme } = useTheme();

  return (
    <div className="fixed bottom-4 right-4 bg-background p-4 rounded shadow-lg text-sm font-mono z-50">
      <div>å½“å‰ä¸»é¢˜: {theme}</div>
      <div>è§£æä¸»é¢˜: {resolvedTheme}</div>
      <div>HTMLç±»: {document.documentElement.className}</div>
    </div>
  );
}
```

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L8-L16)
- [globals.css](file://src/app/globals.css#L45-L122)
