# 项目概述

<cite>
**本文档引用的文件**  
- [page.tsx](file://src/app/(main)/page.tsx)
- [layout.tsx](file://src/app/layout.tsx)
- [error.tsx](file://src/app/error.tsx)
- [not-found.tsx](file://src/app/not-found.tsx)
- [index.tsx](file://src/components/providers/index.tsx)
- [theme.tsx](file://src/components/providers/theme.tsx)
- [query.tsx](file://src/components/providers/query.tsx)
- [package.json](file://package.json)
- [next.config.ts](file://next.config.ts)
- [globals.css](file://src/app/globals.css)
</cite>

## 目录

1. [项目概述](#项目概述)
2. [项目结构](#项目结构)
3. [核心功能与设计目标](#核心功能与设计目标)
4. [技术架构分析](#技术架构分析)
5. [核心组件解析](#核心组件解析)
6. [状态管理与数据同步](#状态管理与数据同步)
7. [主题系统实现](#主题系统实现)
8. [构建与部署配置](#构建与部署配置)

## 项目结构

one-nav 是一个基于现代前端技术栈的书签管理工具，旨在提供快速访问、高效搜索、美观界面和跨平台支持（PWA 和浏览器扩展）。项目采用 Next.js 15 和 React 19 构建，具备服务端渲染（SSR）和静态生成（SSG）能力，确保首屏加载性能和 SEO 优化。

项目目录结构清晰，遵循功能模块化组织原则：

```
.
├── public                  # 静态资源文件
│   ├── background.js       # 浏览器扩展后台脚本
│   ├── ie.html             # IE 浏览器兼容提示页
│   ├── manifest.json       # PWA 应用清单
│   ├── popup.css           # 扩展弹窗样式
│   ├── popup.html          # 扩展弹窗页面
│   └── popup.js            # 扩展弹窗逻辑
├── scripts                 # 构建脚本
│   └── build-ext.mjs       # 扩展构建脚本
├── src                     # 源码目录
│   ├── app                 # Next.js App Router 主入口
│   │   ├── (main)          # 主应用路由
│   │   │   └── page.tsx    # 首页组件
│   │   ├── error.tsx       # 全局错误边界
│   │   ├── globals.css     # 全局样式
│   │   ├── layout.tsx      # 根布局组件
│   │   └── not-found.tsx   # 404 页面
│   ├── components          # 组件库
│   │   ├── providers       # 全局上下文提供者
│   │   │   ├── index.tsx   # 组合所有 Provider
│   │   │   ├── query.tsx   # React Query 配置
│   │   │   └── theme.tsx   # 主题切换配置
│   │   └── ui              # 基于 Radix UI 的原子组件
│   ├── hooks               # 自定义 Hook
│   │   └── use-mobile.ts   # 移动端检测 Hook
│   └── lib                 # 工具函数
│       ├── request.ts      # 请求封装
│       └── utils.ts        # 通用工具
├── README.md               # 项目说明文档
├── components.json         # 组件配置
├── data.json               # 示例数据
├── eslint.config.mjs       # ESLint 配置
├── next.config.ts          # Next.js 配置
├── package.json            # 依赖与脚本定义
├── pnpm-lock.yaml          # 包管理锁文件
├── postcss.config.mjs      # PostCSS 配置
└── tsconfig.json           # TypeScript 配置
```

**Diagram sources**

- [package.json](file://package.json#L1-L143)

## 核心功能与设计目标

one-nav 的核心定位是打造一个现代化、高效且可扩展的个人导航中心。其设计目标包括：

- **快速访问**：通过简洁直观的界面实现书签的一键跳转。
- **高效搜索**：支持关键词快速检索，提升查找效率。
- **美观界面**：采用 Tailwind CSS 实现响应式设计，适配桌面与移动端。
- **跨平台支持**：作为 PWA 支持离线使用，并可通过浏览器扩展集成到日常浏览中。
- **数据持久化与迁移**：支持书签的导入导出，便于备份与跨设备同步。
- **可扩展性**：预留 SSH 连接、脚本执行、两步验证等接口，支持未来功能拓展。

项目通过模块化设计和清晰的职责划分，确保功能的可维护性和可扩展性。

**Section sources**

- [package.json](file://package.json#L100-L140)

## 技术架构分析

one-nav 基于 Next.js 15 的 App Router 架构，结合 React 19 的最新特性，构建了一个高性能、类型安全的前端应用。

### 核心技术栈

- **Next.js 15**：提供 SSR/SSG 能力，优化 SEO 与首屏加载速度。
- **React 19**：利用最新 React 特性提升渲染性能与开发体验。
- **TypeScript**：强类型系统保障代码质量与可维护性。
- **Tailwind CSS**：原子化 CSS 框架，实现高效样式开发。
- **React Query**：用于客户端状态管理与服务端数据同步。
- **Next Themes**：实现系统级暗黑/明亮主题自动切换。

### 构建与部署策略

项目通过 `next.config.ts` 配置了多环境构建策略：

- 开发环境启用 API 代理，便于本地调试。
- 生产环境输出静态文件（`output: 'export'`），支持无服务器部署。

```mermaid
graph TB
subgraph "前端架构"
A[App Router] --> B[Layout & Page]
B --> C[UI Components]
C --> D[Tailwind CSS]
B --> E[Providers]
E --> F[React Query]
E --> G[Next Themes]
E --> H[Sonner Toast]
end
subgraph "构建流程"
I[TypeScript] --> J[Next.js 编译]
J --> K[Tailwind 合并]
K --> L[静态导出]
end
M[Browser] < --> B
N[PWA] --> M
O[Chrome Extension] --> M
style A fill:#f9f,stroke:#333
style B fill:#bbf,stroke:#333
style C fill:#ffb,stroke:#333
style D fill:#bfb,stroke:#333
style E fill:#fbb,stroke:#333
```

**Diagram sources**

- [next.config.ts](file://next.config.ts#L1-L29)
- [package.json](file://package.json#L1-L143)

## 核心组件解析

### 根布局 (Root Layout)

`src/app/layout.tsx` 是整个应用的根布局组件，负责定义 HTML 结构、元数据和全局 Provider 注入。

关键功能包括：

- 设置 `<html>` 和 `<body>` 属性，启用主题切换（`suppressHydrationWarning`）。
- 定义 SEO 元数据（标题、描述、关键词、Open Graph、Twitter Card）。
- 注入 PWA 相关标签（manifest、favicon、theme-color）。
- 动态注入 JSON-LD 结构化数据，提升搜索引擎理解。
- 使用 `<Providers>` 组合所有全局上下文。

```tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={inter.className}>
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
```

SEO 数据来源于 `package.json` 中的自定义 `seo` 字段，便于集中管理。

**Section sources**

- [layout.tsx](file://src/app/layout.tsx#L1-L101)
- [package.json](file://package.json#L100-L140)

### 首页与错误处理

- `src/app/(main)/page.tsx`：当前为占位组件，未来将实现书签网格或列表展示。
- `src/app/error.tsx`：全局错误边界，捕获并处理组件渲染异常。
- `src/app/not-found.tsx`：自定义 404 页面，提升用户体验。

**Section sources**

- [page.tsx](<file://src/app/(main)/page.tsx#L1-L4>)
- [error.tsx](file://src/app/error.tsx)
- [not-found.tsx](file://src/app/not-found.tsx)

## 状态管理与数据同步

项目使用 `@tanstack/react-query` 进行服务端状态管理，通过 `QueryProvider` 封装，实现数据获取、缓存、重试等策略的统一配置。

### React Query 配置分析

`src/components/providers/query.tsx` 中定义了 `QueryClient` 的默认行为：

```tsx
const [queryClient] = useState(
  () =>
    new QueryClient({
      defaultOptions: {
        queries: {
          staleTime: 5 * 60 * 1000, // 数据新鲜期：5分钟
          gcTime: 5 * 60 * 1000, // 缓存保留时间：5分钟
          retry: 3, // 失败重试次数
          retryDelay: (attemptIndex) =>
            Math.min(1000 * 2 ** attemptIndex, 30000), // 指数退避
          refetchOnWindowFocus: false, // 窗口聚焦时不自动刷新
          refetchOnReconnect: true, // 网络重连时自动刷新
        },
        mutations: {
          retry: 1, // 变更操作重试1次
          retryDelay: 1000,
        },
      },
    }),
);
```

该配置平衡了数据实时性与网络请求频率，适合书签类应用的数据访问模式。

**Diagram sources**

- [query.tsx](file://src/components/providers/query.tsx#L1-L46)

## 主题系统实现

主题切换功能由 `next-themes` 提供，封装在 `src/components/providers/theme.tsx` 中。

### 实现机制

```tsx
export function ThemeProvider({ children }: React.PropsWithChildren) {
  return (
    <NextThemesProvider
      attribute="class"
      defaultTheme="system"
      enableSystem
      disableTransitionOnChange
    >
      {children}
    </NextThemesProvider>
  );
}
```

- `attribute="class"`：通过 CSS 类名控制主题（如 `dark` 类），避免内联样式冲突。
- `defaultTheme="system"`：默认跟随系统偏好。
- `enableSystem`：启用系统主题检测。
- `disableTransitionOnChange`：切换主题时禁用动画，提升响应速度。

结合 Tailwind CSS 的 `dark:` 前缀，可轻松实现组件级暗黑模式支持。

**Section sources**

- [theme.tsx](file://src/components/providers/theme.tsx#L1-L18)
- [globals.css](file://src/app/globals.css)

## 构建与部署配置

`next.config.ts` 文件定义了项目的构建行为：

### 多环境配置

- **生产环境**：`output: 'export'` 生成静态文件，适用于 GitHub Pages、Vercel 静态托管等。
- **开发环境**：配置 API 代理，将 `/api/*` 请求转发至本地后端服务（`http://localhost:8000`），便于前后端分离开发。

### 构建脚本

`package.json` 中的脚本定义了完整的构建流程：

- `dev`：启动开发服务器（使用 Turbopack 加速）。
- `build`：构建生产版本。
- `build:ext`：先构建 Next.js 应用，再运行 `build-ext.mjs` 生成浏览器扩展包。

```json
"scripts": {
  "dev": "next dev --turbopack",
  "build": "next build --turbopack",
  "build:ext": "npm run build && node scripts/build-ext.mjs",
  "start": "next start"
}
```

此流程支持将同一代码库同时作为 PWA 和浏览器扩展发布。

**Section sources**

- [next.config.ts](file://next.config.ts#L1-L29)
- [package.json](file://package.json#L5-L15)
